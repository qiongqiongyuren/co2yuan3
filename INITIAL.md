## 功能简介（FEATURE）：

本项目旨在开发一个集**数据收集、自动计算和可视化分析**于一体的综合性碳排放管理平台。平台后端将采用 **Node.js** 实现，为前端（小程序或Web应用）提供稳定、高效的API接口。其核心目标是为内蒙古自治区各级单位的碳排放管理工作提供一个精准、高效、直观的数字化解决方案。

平台主要由三大模块构成：

1. ​**分层交互式数据收集系统**​：一个为各级单位设计的在线填报系统，支持用户根据预设分类（如化石燃料、移动源等）逐级填报详细的活动数据。
2. ​**自动化碳排放计算引擎**​：平台的“核心大脑”，能够根据用户填报的原始数据和内置的官方排放因子，自动完成各类排放量、总排放量及排放强度的复杂计算。
3. ​**多维度数据可视化大屏**​：一个数据看板，通过地图、饼图、柱状图等多种图表，将计算结果进行可视化呈现，并支持多维度、多层级的对比分析功能。

## 详细功能规格（SPECIFICATION）：

### **1. 数据收集系统 (Data Collection)**

#### **a. 账号与权限体系**

* ​**登录机制**​: 采用“一单位一账号”模式。
* ​**账号规格**​: 账号为8位，密码为6位。
* ​**后端支持**​: 后端 `accounts` 数据库集合负责存储账号、加密后的密码、单位名称及该账号绑定的默认行政区划代码。

#### **b. 数据填报流程**

1. ​**登录**​: 用户通过账号密码登录系统。
2. ​**选择行政区划**​: 系统提供“市 → 旗县/区”两级级联选择器。此数据由后端 `getRegionTree` 函数（或对应API）提供，该函数内置了全内蒙古123个旗县的12位行政区划代码。
3. ​**填报数据**​:
   * ​**界面布局**​: 采用折叠面板（Collapse Panel）设计，用户首先看到各大主类别。
   * ​**交互逻辑**​: 点击主类别（如“固体燃料”）后，展开该类别下的所有详细填报项（如“无烟煤(t)”、“烟煤(t)”等）。
   * ​**实时计算反馈**​: **（重要用户体验）** 当用户在输入框填入数值后，界面应在旁边即时显示该单项计算出的CO₂排放量，为用户提供实时参考。

#### **c. 数据分类与单位 (需写入程序的数据结构)**

系统严格按照以下分类进行数据收集，这是前端界面和后端数据库设计的直接依据。

| 主类别                       | 子类别/明细                                                                                                                                   | 数据单位            | 备注                         |
| ------------------------------ | ----------------------------------------------------------------------------------------------------------------------------------------------- | --------------------- | ------------------------------ |
| **化石燃料燃烧 (直接排放)** |                                                                                                                                               |                     |                              |
|                              | ​**固体燃料**​: 无烟煤、烟煤、褐煤、炼焦煤、型煤、焦炭、其它焦化产品                                                                       | 吨 (t)              |                              |
|                              | ​**液体燃料**​: 原油、燃料油、汽油(非车辆)、柴油(非车辆)、煤油、液化石油气、液化天然气、石脑油、沥青、润滑油、石油焦、石化原料油、其它油品 | 吨 (t)              | 严格区分，此为固定设施用燃料 |
|                              | ​**气体燃料**​: 天然气、炼厂干气、焦炉煤气、管道煤气                                                                                       | 立方米 (m³)        | 注意计算时的单位换算         |
| **移动源 (直接排放)**       | 年汽柴油总**购买量**                                                                                                                         | 升 (L)              |                              |
|                              | 汽柴油车辆总**行驶里程**                                                                                                                     | 公里 (km)           |                              |
| **间接排放**                | 净外购**电量**                                                                                                                               | 万千瓦时 (10⁴ kWh) |                              |
|                              | 净外购**热力**                                                                                                                               | 吉焦 (GJ)           |                              |
| **碳排放强度 (计算分母)**   | 机关单位建筑面积                                                                                                                              | 平方米 (m²)        |                              |
|                              | 机关人员数量                                                                                                                                  | 人                  |                              |

Export to Sheets

---

### **2. 自动化碳排放计算引擎 (Calculation Engine)**

这是后端服务的核心，所有计算逻辑和因子都必须在此精确实现。

#### **a. 核心计算逻辑**

* ​**基本公式**​: `碳排放量 = 活动数据 × 排放因子`。
* ​**排放因子来源**​: 所有排放因子均为固定的系数值，必须根据下表被准确无误地硬编码或作为固定配置写入Node.js后端。

#### **b. 排放因子系数表 (需写入程序的固定参数)**

### 燃料种类及其 CO₂ 排放因子

| 燃料大类           | 燃料类型          | CO₂ 排放因子 (tCO₂/t 或 tCO₂/万Nm³) |
| -------------------- | ------------------- | ----------------------------------------- |
| **固体燃料** | 无烟煤（t）       | 2.50                                    |
|                    | 烟煤（t）         | 1.88                                    |
|                    | 褐煤（t）         | 0.97                                    |
|                    | 炼焦煤（t）       | 2.61                                    |
|                    | 型煤（t）         | 2.22                                    |
|                    | 焦炭（t）         | 2.61                                    |
|                    | 其它焦化产品（t） | 2.61                                    |
| **液体燃料** | 原油（t）         | 3.02                                    |
|                    | 燃料油（t）       | 3.17                                    |
|                    | 汽油（t）         | 3.02                                    |
|                    | 柴油（t）         | 3.18                                    |
|                    | 一般煤油（t）     | 3.03                                    |
|                    | 液化石油气（t）   | 3.16                                    |
|                    | 液化天然气（t）   | 3.11                                    |
|                    | 石脑油（t）       | 3.02                                    |
|                    | 沥青（t）         | 3.31                                    |
|                    | 润滑油（t）       | 3.09                                    |
|                    | 石油焦（t）       | 3.18                                    |
|                    | 石化原料油（t）   | 3.09                                    |
|                    | 其他油品（t）     | 3.09                                    |
| **气体燃料** | 天然气（m³）     | 21.62                                   |
|                    | 炼厂干气（m³）   | 26.11                                   |
|                    | 焦炉煤气（m³）   | 8.36                                    |
|                    | 管道煤气（m³）   | 5.00                                    |

---

### 外购电力和热力间接排放因子

| 能源品种       | 排放因子        |
| ---------------- | ----------------- |
| **电力** | 0.79 吨CO₂/MWh |
| **热力** | 100 kgCO₂e/GJ  |


#### **c. 具体计算公式 (需写入程序的计算逻辑)**

* ​**固体/液体燃料**​:
  * `排放量(tCO₂) = 燃料消耗量(t) × 对应的CO₂排放因子(tCO₂/t)`。
* ​**气体燃料 (注意单位换算)**​:
  * `排放量(tCO₂) = (天然气消耗量(m³) / 10000) × 21.62 tCO₂/万Nm³`。
* ​**间接排放 (注意单位换算)**​:
  * ​**电力**​: `排放量(tCO₂) = 净外购电量(10⁴kWh) × 10 MWh/10⁴kWh × 0.79 tCO₂/MWh`。
  * ​**热力**​: `排放量(tCO₂e) = 净外购热力(GJ) × 100 kgCO₂e/GJ × 0.001 t/kg = 净外购热力(GJ) × 0.1 tCO₂/GJ`。
* ​**汇总与强度计算**​:
  * `碳排放总量 = Σ(各类直接排放) + Σ(各类间接排放)`。
  * `单位建筑面积碳排放量 = 碳排放总量 / 机关单位建筑面积`。
  * `人均碳排放量 = 碳排放总量 / 机关人员数量`。

---

### **3. 数据可视化大屏 (Visualization Dashboard)**

前端根据后端API返回的数据，渲染以下图表。

#### **a. 展示逻辑**

* ​**主体**​: 以单个“单位”作为图表生成的基础。
* ​**对比分析**​: 默认展示单个单位的数据，同时提供与**所有同级别**行政单位进行对比的功能。

#### **b. 图表清单与展示内容 (前端实现规格)**

| 图表类型    | 展示内容                                                                                                       | 对比方式                                               | 显示条件                    |
| ------------- | ---------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------- | ----------------------------- |
| **地图**   | 各地区（市、旗县）碳排放总量分布                                                                               | 市与市之间对比                                         | 无                          |
| **饼图**   | 单个单位的：
- 化石燃料燃烧碳排放量占比
- 移动源燃烧碳排放量占比
- 外购电力碳排放量占比
- 外购热力碳排放量占比 | 先展示本单位内部构成，再与同级别其他单位的同类指标对比 | 无                          |
| **柱状图** | - 单位建筑面积碳排放量
- 人均碳排放量                                                                          | 市与市对比、旗县与旗县对比                             | 无                          |
|             | - 间接排放量（按年份）
- 直接排放量（按年份）
- 碳排放总量（按年份）                                           | 市与市对比、旗县与旗县对比                             | 统计到该单位数据**>= 2年** |
| **折线图** | 碳排放总量年均变化率                                                                                           | 市与市对比、旗县与旗县对比                             | 统计到该单位数据**>= 2年** |

Export to Sheets

## 技术实现与示例（IMPLEMENTATION & EXAMPLES）：

### **1. 后端技术架构 (Node.js)**

* **API 接口 (Node.js / Express.js 示例)** | 方法 | 路由 (Endpoint) | 作用 | | :--- | :--- | :--- | | `POST` | `/api/auth/login` | 登录校验：接收账号密码，验证用户身份，返回token。 | | `GET` | `/api/regions` | 区划数据：下发内蒙古自治区完整的行政区划树形数据。 | | `POST` | `/api/carbon-data` | 数据入库：接收前端填报的完整数据，执行最终校验、调用计算引擎、并将完整数据写入数据库。 | | `GET` | `/api/reports/markdown` | 导出功能：根据请求参数生成并返回指定格式的报告。 | | `GET` | `/api/reports/csv` | 导出功能：根据请求参数生成并返回指定格式的数据表。 |
* **数据库 (Database)**
  * 推荐使用 ​**MongoDB**​，其文档型数据结构非常适合存储本项目的JSON格式数据。
  * ​**集合 (Collections)**​:
    * `accounts`: 存储单位的账号、密码、单位名称、默认区划等信息。
    * `carbon_data`: 存储每一次成功提交的完整碳排放数据，包含所有原始活动数据、使用的排放因子、计算结果以及时间戳等元数据。
* **部署 (Deployment)**
  1. 环境准备: 在服务器上安装 Node.js 和 npm/yarn。
  2. 安装依赖: 在项目根目录下运行 `npm install`。
  3. 启动服务: 使用进程守护管理器（如 ​**PM2**​）来启动和管理Node.js应用 (`pm2 start app.js --name carbon-platform`)。

### **2. 示例文件结构 (建议)**

为了帮助开发团队统一认知和进行接口调试，建议在项目内创建 `examples/` 文件夹。

* `examples/README.md`：详细说明该目录下各个示例的作用和使用方法。
* `examples/api_requests/`：存放与后端API交互的示例（如 `curl` 命令或 `.http` 文件）。
* `examples/data_formats/`：存放核心数据结构的JSON示例文件。

## 文档与资源（DOCUMENTATION & RESOURCES）：

* ​**项目后端API协议(API)**​：[待补充的API文档内部链接，例如指向Swagger或Postman文档]
* ​**Node.js 官方文档**​： 👉 [https://nodejs.org/en/docs/](https://nodejs.org/en/docs/)
* ​**Express.js 框架文档 (推荐)**​： 👉 [https://expressjs.com/](https://expressjs.com/)
* ​**MongoDB 数据库文档**​： 👉 [https://www.mongodb.com/docs/](https://www.mongodb.com/docs/)
* ​**前端ECharts图表库配置项文档**​： 👉 [https://echarts.apache.org/zh/option.html](https://echarts.apache.org/zh/option.html)

## 其他注意事项（OTHER CONSIDERATIONS）：

* ​**环境变量**​:
  * 项目根目录需提供一个 `.env.example` 文件，用于说明所有必需的环境变量（如数据库连接字符串、服务器端口、JWT密钥等）。
  * Node.js 应用中应使用 `dotenv` 包，并通过 `require('dotenv').config()` 在程序启动时加载环境变量。
* ​**排放因子与单位换算**​:
  * ​**这是最重要的技术点**​。系统中所有排放因子必须根据本文档提供的系数表被准确无误地实现到后端计算逻辑中。
  * 后端在执行计算时，必须特别注意**单位换算**的严谨性，这是最容易出现计算错误的地方。
* ​**UI标签的明确性**​: 前端所有图表和数据显示区域，都必须有非常明确的标题和标签，清晰地区分​**原始活动数据**​（如：消耗10t无烟煤）和​**计算结果**​（如：产生25t CO₂排放）。
* ​**数据安全**​: 密码等敏感信息在存入`accounts`集合时必须进行哈希加盐处理。API接口应做好权限校验（如JWT），防止未授权访问。