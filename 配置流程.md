# 项目配置与运行流程

本文档旨在引导开发者完成项目的本地环境配置和启动流程。

---

## 1. 环境要求

在开始之前，请确保您的开发环境中已安装以下软件：

- **Node.js**: `v16.0.0` 或更高版本
- **npm**: `v8.0.0` 或更高版本 (通常随 Node.js 一起安装)
- **MongoDB**: 本地或远程的 MongoDB 数据库实例

---

## 2. 后端配置

### 2.1. 安装依赖

在项目根目录下，首先进入 `server` 目录，然后使用 `npm` 安装后端所需的依赖：

```bash
cd server
npm install
```

### 2.2. 配置环境变量

在 `根` 目录下，复制 `.env.example` 文件并重命名为 `.env`：

```bash
cp .env.example .env
```

**下面不用管,用默认的就行.**

接下来，编辑 `.env` 文件，并根据您的本地环境配置以下变量：

- **`PORT`**: 后端服务运行的端口 (例如 `5000`)。
- **`MONGODB_URI`**: 您的 MongoDB 连接字符串 (例如 `mongodb://localhost:27017/carbon_platform`)。
- **`JWT_SECRET`**: 用于生成 JSON Web Token 的密钥 (可以是一个任意的长字符串)。

### 2.4. 启动后端服务

完成配置后，在 `server` 目录下运行以下命令启动后端开发服务器：

```bash
npm run dev
```

如果一切正常，您应该会在终端看到服务器成功连接到数据库并监听指定端口的日志。

---

## 3. 前端配置

### 3.1. 安装依赖

打开一个新的终端窗口，在项目根目录下进入 `client` 目录，然后使用 `npm` 安装前端所需的依赖：

```bash
cd client
npm install
```

### 3.2. 启动前端服务

安装完成后，在 `client` 目录下运行以下命令启动前端开发服务器：

```bash
npm run dev
```

Vite 会启动一个本地开发服务器 (通常在 `http://localhost:5173`)，并自动在浏览器中打开应用。

---

## 4. 访问应用

- **前端**: 在浏览器中打开 Vite 提供的本地开发服务器地址 (例如 `http://localhost:5173`)。
- **后端 API**: 后端服务将在您于 `.env` 文件中配置的端口上运行 (例如 `http://localhost:5000`)。

现在，您应该可以与应用进行交互了。

---

## 5. macOS 系统下的常见问题与解决方案

在 macOS 系统下运行此项目时，可能会因为 `canvas` 模块的安装问题而遇到错误。`canvas` 是一个需要编译的原生 Node.js 模块，它依赖于一些系统级的图形库。

### 问题描述

在 `server` 目录下运行 `npm install` 时，可能会出现类似以下的编译错误：

```
gyp ERR! build error
gyp ERR! stack Error: `make` failed with exit code: 2
...
```

这通常表示缺少必要的编译工具或库。

### 解决方案

要解决此问题，您需要安装 `node-gyp` 的依赖项。对于 macOS，最简单的方法是使用 [Homebrew](https://brew.sh/) 来安装这些工具。

1. **安装 Homebrew** (如果尚未安装):
   
   ```bash
   /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
   ```

2. **安装 `canvas` 的依赖库**:
   
   ```bash
   brew install pkg-config cairo pango libpng jpeg giflib librsvg
   ```

3. **重新安装依赖**:
   
   安装完系统库后，回到 `server` 目录，删除 `node_modules` 文件夹和 `package-lock.json` 文件，然后重新运行 `npm install`：
   
   ```bash
   cd server
   rm -rf node_modules package-lock.json
   npm install
   ```

完成这些步骤后，`canvas` 模块应该能够成功编译和安装，后端服务也应该能正常启动。
